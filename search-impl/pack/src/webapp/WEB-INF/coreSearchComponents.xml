<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<!--
/**********************************************************************************
 * $URL:  $
 * $Id:  $
 ***********************************************************************************
 *
 * Copyright (c) 2003, 2004, 2005, 2006 The Sakai Foundation.
 *
 * Licensed under the Educational Community License, Version 1.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.opensource.org/licenses/ecl1.php
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 **********************************************************************************/
-->
<beans>
 

  <bean id="org.sakaiproject.search.api.SearchService"
    class="org.sakaiproject.search.component.service.impl.SearchServiceImpl" 
    init-method="init" >
    <property name="indexStorage"><ref bean="searchStorageImpl" /></property>
  </bean> 
    
  <bean id="org.sakaiproject.search.api.SearchIndexBuilder"
    class="org.sakaiproject.search.component.service.impl.SearchIndexBuilderImpl" 
    init-method="init" >
    <property name="searchBuilderItemDao"><ref bean="searchBuilderItemDao" /></property>
  </bean>

  <bean id="org.sakaiproject.search.api.SearchIndexBuilderWorker"
    class="org.sakaiproject.search.component.service.impl.SearchIndexBuilderWorkerImpl" 
    init-method="init" destroy-method="destroy">
    <property name="sleepTime"><value>30000</value></property>
    <property name="dataSource">
      <ref bean="javax.sql.DataSource"/>      
    </property>
    <property name="searchIndexBuilderWorkerDao"><ref bean="searchIndexBuilderWorkerDao" /></property>
  </bean>
  
  
  <bean id="org.sakaiproject.search.SearchSessionFactory"
    parent="org.sakaiproject.springframework.orm.hibernate.SessionFactoryBase">
    
    <property name="dataSource">
      <ref bean="javax.sql.DataSource"/>
    </property>
    <property name="mappingResources">
      <list>
        <value>org/sakaiproject/search/model/impl/search.hbm.xml</value>
      </list>
    </property>
  </bean>
  
  <bean id="org.sakaiproject.search.SearchTransactionManager"
    class="org.springframework.orm.hibernate3.HibernateTransactionManager">
    <property name="sessionFactory"><ref
      bean="org.sakaiproject.search.SearchSessionFactory"/>
    </property>
  </bean>
  
  <!-- START NEW STUFF -->
  <!-- Register the Data Access Object as a Transactional Interceptor -->
  <bean id="searchBuilderItemDao"
    class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
    <property name="transactionManager"><ref
      bean="org.sakaiproject.search.SearchTransactionManager"/>
    </property>
    <property name="transactionAttributes">
      <props>
        <prop key="update*">PROPAGATION_REQUIRED</prop>
        <prop key="delete*">PROPAGATION_REQUIRED</prop>
      </props>
    </property>
    <property name="target"><ref bean="searchBuilderItemDaoImpl"/></property>
  </bean>
  
  <bean id="searchBuilderItemDaoImpl"
    class="org.sakaiproject.search.component.dao.impl.SearchBuilderItemDaoImpl" singleton="true">
    <property name="sessionFactory"><ref
      bean="org.sakaiproject.search.SearchSessionFactory"/>
    </property>
  </bean>

  <bean id="searchIndexBuilderWorkerDao"
    class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
    <property name="transactionManager"><ref
      bean="org.sakaiproject.search.SearchTransactionManager"/>
    </property>
    <property name="transactionAttributes">
      <props>
        <prop key="processToDoListTransaction">PROPAGATION_REQUIRED</prop>
      </props>
    </property>
    <property name="target"><ref bean="searchIndexBuilderWorkerDaoImpl"/></property>
  </bean>
  
  <bean id="searchIndexBuilderWorkerDaoImpl"
    class="org.sakaiproject.search.component.dao.impl.SearchIndexBuilderWorkerDaoImpl" 
    init-method="init" >
    <property name="sessionFactory" ><ref bean="org.sakaiproject.search.SearchSessionFactory" /></property>
    <property name="indexStorage"><ref bean="searchStorageImpl" /></property>
  </bean>
  
  <bean id="searchStorageImpl" 
    class="org.sakaiproject.search.index.impl.FSIndexStorage" 
    >
    <property name="searchIndexDirectory"><value>${sakai.home}/searchindex</value></property>
    <property name="analyzerFactory" ><ref bean="searchAnalyzerImpl" /></property>    
  </bean>
  
  <bean id="searchAnalyzerImpl" 
    class="org.sakaiproject.search.index.impl.SnowballAnalyzerFactory" 
    >
   </bean>
  
  
  
  
</beans>
